// sacramento population script

#include "_ai.fos"
#include "_macros.fos"
#include "_math.fos"
#include "_maps.fos"
#include "npc_planes.fos"

#include "cimp.fos"

// import void ChangeBrokeAndAmmo(Item& item) from "mapgen_paste_items.fos";
import void ActivateMobScript( Map& map ) from "mob";
import void SetDeterioration( Item& item, int wearProcent ) from "repair";


#define START_ENT         ( 30 )
#define END_ENT           ( 38 )
#define POPUL_MOD         ( 10 )
#define MAP_SACR_ID       ( 100 )
#define MAP_TIME_DATA     ( 1 )
#define ITEM_ACCESSORY    ( 0 )

#define RESPAWN_TIME      ( 60 * 60 * 60 * __TimeMultiplier )

/*	    #define MAP_SATTER_11					(60)
   #define MAP_SATTER_11_DN				(61)
   #define MAP_SATTER_12					(63)
   #define MAP_SATTER_12_DN				(64)
   #define MAP_SATTER_13					(65)
   #define MAP_SATTER_13_DN				(66)
   #define MAP_SATTER_14					(67)
   #define MAP_SATTER_14_DN				(68)

   #define MAP_SATTER_21					(69)
   #define MAP_SATTER_21_DN				(70)
   #define MAP_SATTER_24					(71)
   #define MAP_SATTER_24_DN				(72)
   #define MAP_SATTER_31					(73)
   #define MAP_SATTER_31_DN				(74)
   #define MAP_SATTER_34					(75)
   #define MAP_SATTER_34_DN				(76)

   #define MAP_SATTER_41					(77)
   #define MAP_SATTER_41_DN				(78)
   #define MAP_SATTER_42					(79)
   #define MAP_SATTER_42_DN				(80)
   #define MAP_SATTER_43					(81)
   #define MAP_SATTER_43_DN				(82)
   #define MAP_SATTER_44					(83)
   #define MAP_SATTER_44_DN				(84)

   #define MAP_SATTER_CENTER				(88)
   #define MAP_SATTER_CENTER_DN				(89)
   #define MAP_SATTER_CENTER_UP				(90)
 #define MAP_SATTER_CENTER_UP_1				(91)*/

uint8 timeNum = 0;
/************
   debug
************/

uint8 CheckNpcAi( uint16 crType )
{
    uint8 retn = 0;
    switch( crType )
    {
    case 5:
        retn = AIPACKET_SCORPION;
        break;
    case 9:
        retn = AIPACKET_GENERIC_DOG;
        break;
    case 11:
        retn = AIPACKET_RAT;
        break;
    case 80:
        retn = AIPACKET_GECKO;
        break;
    case 83:
        retn = AIPACKET_GECKO;
        break;
    case 85:
        retn = AIPACKET_DEATHCLAW;
        break;
    case 113:
        retn = AIPACKET_RAT;
        break;
    case 117:
        retn = AIPACKET_RAT;
        break;
    case 119:
        retn = AIPACKET_SUPER_MUTANT;
        break;
    case 177:
        retn = AIPACKET_FLOATER;
        break;
    case 249:
        retn = AIPACKET_CENTAUR;
        break;
    default:
        retn = 0;
        break;
    }
    return retn;
}


void TeleportNpcToMap( Critter& npc )
{
    // Location @ loc = npc.GetMap().GetLocation();
    // Map @ map = loc.GetMapByIndex(0);
    // npc.TransitToMap(map.Id, 1);
    // Map @ map = GetMapByPid(GetCritInfo(npc.GetMap().GetProtoId(),0,4), 0);
    // npc.TransitToMap(map.Id, 1);
}

void runmobspawn( Critter& player, int param0, int param1, int param2 )
{
    Map @ map = player.GetMap();
    AddCritter( map );
}

void runitemspawn( Critter& player, int param0, int param1, int param2 )
{
    Map @ map = player.GetMap();
    FillContainer( map );
}

void ChangeBrokeAndAmmo( Item& item )
{
    if( item.IsDeteriorable() )                                         // проверяем ломается ли итем
    {
        SetDeterioration( item, Random( 30, 90 ) );                     // ломаем его
        if( item.AmmoCount > 0 )
        {
            item.AmmoCount = Random( 0, item.AmmoCount );
//                CaseAmmoWeaponCount(item, item.AmmoCount);
        }
    }
}

void testspawn( Critter& cr, int, int, int )
{
    _MapInit( cr.GetMap(), true );
}

void _MapInit( Map& map, bool firstTime )
{
    /* uint[] values = {map.Id};
       timeNum = CreateTimeEvent(__FullSecond+RESPAWN_TIME, "e_SpawnStuff", values, false);
       map.SetData(MAP_TIME_DATA, timeNum);
       timeNum = 0;*/
}

uint e_SpawnStuff( uint[] @ values )
{
//   uint8 itemPid = 0;
    Map @ map = GetMap( values[ 0 ] );
    if( !valid( map ) )
        return 0;
    FillContainer( map );
    SpawnLO( map );
    // AddCritter(map);
    EraseTimeEvent( map.GetData( MAP_TIME_DATA ) );
    timeNum = CreateTimeEvent( __FullSecond + RESPAWN_TIME /*(60*60*(24+Random(0,23)))*/, "e_SpawnStuff", values, false );
    map.SetData( MAP_TIME_DATA, timeNum );
    timeNum = 0;
    return 0;
}

string msg;

void FillContainer( Map& map ) // 343
{
    Item@[] containers;
    uint16 itemPid = 0;        // , temp = 0;
    map.GetItemsByType( ITEM_TYPE_CONTAINER, containers );
    if( valid( containers ) && containers.length() != 0 )
    {
        Item @ item;
        for( uint16 i = 0; i < containers.length(); i++ )
        {
            Item@[] contBag;

            if( containers[ i ] is null )
                continue;
            if( containers[ i ].GetProtoId() == PID_LO_CONTAINER )
            {
                DeleteItem( containers[ i ] );
                continue;
            }

            containers[ i ].GetItems( ITEM_ACCESSORY, contBag );
            if( valid( contBag ) && contBag.length() == 0 )
            {
                itemPid = Random( 0, satterGroup.length() - 1 );
                @item = containers[ i ].AddItem( satterGroup[ itemPid ], Random( 1, satterGroupMod[ itemPid ] ), ITEM_ACCESSORY );
                i += Random( 0, Random( 1, 4 ) );
                if( valid( item ) )
                {
                    ChangeBrokeAndAmmo( item );
//          temp++;
//          msg = itemPid;
//          Log(msg);
                }

            }
//       else
//       {msg = "full cont "+contBag.length(); Log(msg);}
        }
    }
//   msg = temp+" of "+containers.length();
//   Log(msg);
}
/*
   void AddCritter(Map& map) //310			//old spawn
   {
   Critter@[] npcs;
   uint16 hexX = 0, hexY = 0, crCount = 0, teamId = 0, temp = 0;
   //   msg = "critterTypes[i]";
   for(uint8 i = 0; i < GetCritInfo(map.GetProtoId(),i,3); i++)
   {/*
    hexX = Random(60, 140);
    hexY = Random(60, 140);//
    crCount = map.GetCritters(GetCritInfo(map.GetProtoId(),i,0), FIND_LIFE | FIND_ONLY_NPC, npcs);
   //     temp = ABS();
    if(crCount < ABS(GetCritInfo(map.GetProtoId(),i,1) / 5))
    {
      for(uint8 j = 0; j < map.CountEntire(GetCritInfo(map.GetProtoId(),i,2)); j++)
      {
        teamId = Random(24, 33);
        if(map.GetEntireCoords(GetCritInfo(map.GetProtoId(),i,2), j, hexX, hexY))
        {
          for(uint8 jj = GetCritInfo(map.GetProtoId(),i,1); jj > Random(GetCritInfo(map.GetProtoId(),i,1) / 2, GetCritInfo(map.GetProtoId(),i,1) - crCount); jj--)
          {
            if(map.IsHexPassed(hexX, hexY))
            {
              Critter @ npc = map.AddNpc(GetCritInfo(map.GetProtoId(),i,0), hexX, hexY, Random(0,5), null, null, null);
              npc.StatBase[ST_AI_ID] = CheckNpcAi(npc.CrType);
              npc.StatBase[ST_TEAM_ID] = teamId;
   //         if(valid(npc)) {msg = "hexX= "+npc.HexX+" hexY= "+npc.HexY; Log(msg);}
              hexX += Random(1,4);
              hexY -= Random(1,4);
            }
            else
            {
              hexX -= Random(1,4);
              hexY += Random(1,4);
            }
          }
        }
        else {msg =  GetCritInfo(map.GetProtoId(),i,2); Log(msg);}
      }
      ActivateMobScript(map);
    }
    /*
    else
     {

   //   crs[i].
   //   for(uint8 j = 0; j < map.CountEntire(critterSpawn[i]); j++)
        if(map.GetEntireCoords(1, 0, hexX, hexY))
        {
         for(uint8 ii = 0; ii < npcs.length(); ii++)
          {
            hexX = Random(60, 140);
            hexY = Random(60, 140);
            AddWalkPlane(npcs[ii], AI_PLANE_WALK_PRIORITY , hexX, hexY, Random(0,5), false, 0);
            AddMiscPlane(npcs[ii], AI_PLANE_WALK_PRIORITY-1, 0, "TeleportNpcToMap");
            AddWalkPlane(npcs[ii], AI_PLANE_WALK_PRIORITY-2 , hexX, hexY, Random(0,5), false, 0);
   //       msg = "crCount = "+crCount;
   //       Log(msg);

          }
        }
      }*
    }
   }*/

/****************************************
   /***********************GROUPS***********
   /***************************************/
/*int16 GetCritInfo(uint16 mapProto, uint16 i, uint8 type)			//old
   {
   switch(mapProto)
   {
    case 20: switch(type)
              {
                case 0: return critterTypes_20[i];
                case 1: return critterPopul_20[i];
                case 2: return critterSpawn_20[i];
                case 3: return critterTypes_20.length();
                case 4: return 18;
              }
    case 101: switch(type)
              {
                case 0: return critterTypes_101[i];
                case 1: return critterPopul_101[i];
                case 2: return critterSpawn_101[i];
                case 3: return critterTypes_101.length();
                case 4: return 100;
              }
    case 103: switch(type)
              {
                case 0: return critterTypes_101[i];
                case 1: return critterPopul_101[i];
                case 2: return critterSpawn_101[i];
                case 3: return critterTypes_101.length();
                case 4: return 100;
              }
   }
   return 0;
   }*/

#define CRITTER_FIELD_PID             ( 1 )
#define CRITTER_FIELD_POP             ( 2 )
#define CRITTER_FIELD_PNT             ( 3 )

#define CRITTER_FIELD_COUNT           ( 3 )

#define CRITTER_MAP_COUNT             ( 32 )
#define CRITTER_MAP_START             ( 60 )
/*						!!!use maps const from _maps.fos!!!
   #define CRITTER_MAP_SAT_11		(1)
   #define CRITTER_MAP_SAT_12		(2)
   #define CRITTER_MAP_SAT_13		(3)
   #define CRITTER_MAP_SAT_14		(4)

   #define CRITTER_MAP_SAT_CN		(5)
   #define CRITTER_MAP_SAT_CN_DN		(6)
 */

// //////////////////////////////////////////

#define CRITTER_COUNT                 ( 32 )
#define CRITTER_SPAWN_START           ( 200 )
#define CRITTER_PID_START             ( 310 )

#define CRITTER_RAT_SPAWN             ( 200 ) //	310	Крыса
#define CRITTER_MANTIS_SPAWN          ( 201 ) //	311	Мантис
#define CRITTER_ANT_SPAWN             ( 202 ) //	312	Муравей
#define CRITTER_PIGRAT_SPAWN          ( 203 ) //	313	Кротокрыс
#define CRITTER_GRIZZRAT_SPAWN        ( 204 ) //	314	Крот Гриззли
#define CRITTER_PIGRATM_SPAWN         ( 205 ) //	315	Кротокрыс мутант
#define CRITTER_GECKO_SPAWN           ( 206 ) //	316	Обычный геккон
#define CRITTER_GECKO_GOLD_SPAWN      ( 207 ) //	317	Золотой геккон
#define CRITTER_DOG_SPAWN             ( 208 ) //	318	Собака
#define CRITTER_SCORP_SLAMLL_SAPWN    ( 209 ) //	319	Скорпион
#define CRITTER_SCORP_BIG             ( 210 ) //	320	Большой скорпион
#define CRITTER_BRAHMIN               ( 211 ) //	321	Брамин
#define CRITTER_EVILPLANT_SPAWN       ( 212 ) //	322	Хищное растение
#define CRITTER_ALIEN_SPAWN           ( 213 ) //	323	Чужой
#define CRITTER_CLAW_SMAL_SPAWN       ( 214 ) //	324	Маленький коготь смерти
#define CRITTER_CLAW_SPAWN            ( 215 ) //	325	Коготь смерти
#define CRITTER_CLAW_GRAY_SPAWN       ( 216 ) //	326	Серый коготь смерти
#define CRITTER_GECKO_FIRE_SPAWN      ( 217 ) //	327	Огнедышащий геккон
#define CRITTER_CENTAUR_SPAWN         ( 218 ) //	328	Псевдо-кентавр
#define CRITTER_FLOATER_SPAWN         ( 219 ) //	329	Летатель
#define CRITTER_SWEMPER_SPAWN         ( 220 ) //	330	Болотник
#define CRITTER_RIPPER_M_SPAWN        ( 221 ) //	335	Потрошитель
#define CRITTER_RIPPER_F_SPAWN        ( 222 ) //	336	Потрошительница
#define CRITTER_RAIDER_M_SPAWN        ( 223 ) //	337	Бандит
#define CRITTER_RAIDER_F_SPAWN        ( 224 ) //	338	Бандитка
#define CRITTER_RAIDER_A_SPAWN        ( 225 ) //	339	Мародер //A == alien :D
#define CRITTER_RAIDER_B_SPAWN        ( 226 ) //	340	Рейдер //just abc :D
#define CRITTER_RAIDER_C_SPAWN        ( 227 ) //	341	Рейдерша
#define CRITTER_SLAVER_SPAWN          ( 228 ) //	342	Работорговец
#define CRITTER_RAIDER_D_SPAWN        ( 229 ) //	343	Мародер
#define CRITTER_RAIDER_E_SPAWN        ( 230 ) //	344	Налетчик
#define CRITTER_RAIDER_F_SPAWN        ( 231 ) //	345	Налетчица

#define CRITTER_RAT_PID               ( 310 ) //	Крыса
#define CRITTER_MANTIS_PID            ( 311 ) //	Мантис
#define CRITTER_ANT_PID               ( 312 ) //	Муравей
#define CRITTER_PIGRAT_PID            ( 313 ) // Кротокрыс
#define CRITTER_GRIZZRAT_PID          ( 314 ) //	Крот Гриззли
#define CRITTER_PIGRATM_PID           ( 315 ) //	Кротокрыс мутант
#define CRITTER_GECKO_PID             ( 316 ) //	Обычный геккон
#define CRITTER_GECKO_GOLD_PID        ( 317 ) //	Золотой геккон
#define CRITTER_DOG_PID               ( 318 ) //	Собака
#define CRITTER_SCORP_SLAMLL_SAPWN    ( 319 ) //	Скорпион
#define CRITTER_SCORP_BIG             ( 320 ) //	Большой скорпион
#define CRITTER_BRAHMIN               ( 321 ) //	Брамин
#define CRITTER_EVILPLANT_PID         ( 322 ) //	Хищное растение
#define CRITTER_ALIEN_PID             ( 323 ) //	Чужой
#define CRITTER_CLAW_SMAL_PID         ( 324 ) //	Маленький коготь смерти
#define CRITTER_CLAW_PID              ( 325 ) //	Коготь смерти
#define CRITTER_CLAW_GRAY_PID         ( 326 ) //	Серый коготь смерти
#define CRITTER_GECKO_FIRE_PID        ( 327 ) //	Огнедышащий геккон
#define CRITTER_CENTAUR_PID           ( 328 ) //	Псевдо-кентавр
#define CRITTER_FLOATER_PID           ( 329 ) //	Летатель
#define CRITTER_SWEMPER_PID           ( 330 ) //	Болотник
#define CRITTER_RIPPER_M_PID          ( 335 ) //	Потрошитель
#define CRITTER_RIPPER_F_PID          ( 336 ) //	Потрошительница
#define CRITTER_RAIDER_M_PID          ( 337 ) //	Бандит
#define CRITTER_RAIDER_F_PID          ( 338 ) //	Бандитка
#define CRITTER_RAIDER_A_PID          ( 339 ) //	Мародер //A == alien :D
#define CRITTER_RAIDER_B_PID          ( 340 ) //	Рейдер //just abc :D
#define CRITTER_RAIDER_C_PID          ( 341 ) //	Рейдерша
#define CRITTER_SLAVER_PID            ( 342 ) //	Работорговец
#define CRITTER_RAIDER_D_PID          ( 343 ) //	Мародер
#define CRITTER_RAIDER_E_PID          ( 344 ) //	Налетчик
#define CRITTER_RAIDER_F_PID          ( 345 ) //	Налетчица

#define CRITTER_RAT_COUNT             ( 5 ) //	Крыса
#define CRITTER_MANTIS_COUNT          ( 6 ) //	Мантис
#define CRITTER_ANT_COUNT             ( 6 ) //	Муравей
#define CRITTER_PIGRAT_COUNT          ( 4 ) // Кротокрыс
#define CRITTER_GRIZZRAT_COUNT        ( 1 ) //	Крот Гриззли
#define CRITTER_PIGRATM_COUNT         ( 1 ) //	Кротокрыс мутант
#define CRITTER_GECKO_COUNT           ( 4 ) //	Обычный геккон
#define CRITTER_GECKO_GOLD_COUNT      ( 2 ) //	Золотой геккон
#define CRITTER_DOG_COUNT             ( 3 ) //	Собака
#define CRITTER_SCORP_SLAMLL_SAPWN    ( 3 ) //	Скорпион
#define CRITTER_SCORP_BIG             ( 2 ) //	Большой скорпион
#define CRITTER_BRAHMIN               ( 3 ) //	Брамин
#define CRITTER_EVILPLANT_COUNT       ( 5 ) //	Хищное растение
#define CRITTER_ALIEN_COUNT           ( 1 ) //	Чужой
#define CRITTER_CLAW_SMAL_COUNT       ( 2 ) //	Маленький коготь смерти
#define CRITTER_CLAW_COUNT            ( 1 ) //	Коготь смерти
#define CRITTER_CLAW_GRAY_COUNT       ( 1 ) //	Серый коготь смерти
#define CRITTER_GECKO_FIRE_COUNT      ( 1 ) //	Огнедышащий геккон
#define CRITTER_CENTAUR_COUNT         ( 2 ) //	Псевдо-кентавр
#define CRITTER_FLOATER_COUNT         ( 3 ) //	Летатель
#define CRITTER_SWEMPER_COUNT         ( 2 ) //	Болотник
#define CRITTER_RIPPER_M_COUNT        ( 3 ) //	Потрошитель
#define CRITTER_RIPPER_F_COUNT        ( 3 ) //	Потрошительница
#define CRITTER_RAIDER_M_COUNT        ( 2 ) //	Бандит
#define CRITTER_RAIDER_F_COUNT        ( 2 ) //	Бандитка
#define CRITTER_RAIDER_A_COUNT        ( 2 ) //	Мародер //A == alien :D
#define CRITTER_RAIDER_B_COUNT        ( 2 ) //	Рейдер //just abc :D
#define CRITTER_RAIDER_C_COUNT        ( 2 ) //	Рейдерша
#define CRITTER_SLAVER_COUNT          ( 2 ) //	Работорговец
#define CRITTER_RAIDER_D_COUNT        ( 2 ) //	Мародер
#define CRITTER_RAIDER_E_COUNT        ( 2 ) //	Налетчик
#define CRITTER_RAIDER_F_COUNT        ( 2 ) //	Налетчица



bool critters_inited = false;

uint16[][] CritterInfo( ( CRITTER_MAP_COUNT + 1 )* CRITTER_FIELD_COUNT );

bool CritterInfoInit()
{

    uint16[] @ data0;
    uint16[] @ data1;
    uint16[] @ data2;

    uint16[] pids( 0 );
    uint16[] count( 0 );
    uint16[] spawns( 0 );

//	Log("len "+CritterInfo.length());
    // CritterInfo.resize((CRITTER_MAP_COUNT + 1) * CRITTER_FIELD_COUNT);

    for( uint16 i = 0; i < CRITTER_COUNT; ++i )
    {
        pids.insertLast( CRITTER_PID_START + i );
       // count.insertLast( 6 );      /*CRITTER_PID_START+i*/
        spawns.insertLast( CRITTER_SPAWN_START + i );
    }
    
	count.insertLast( CRITTER_RAT_COUNT ); //	Крыса
	count.insertLast( CRITTER_MANTIS_COUNT );
	count.insertLast( CRITTER_ANT_COUNT );
	count.insertLast( CRITTER_PIGRAT_COUNT );
	count.insertLast( CRITTER_GRIZZRAT_COUNT );
	count.insertLast( CRITTER_PIGRATM_COUNT );
	count.insertLast( CRITTER_GECKO_COUNT );
	count.insertLast( CRITTER_GECKO_GOLD_COUNT );
	count.insertLast( CRITTER_DOG_COUNT );
	count.insertLast( CRITTER_SCORP_SLAMLL_SAPWN );
	count.insertLast( CRITTER_SCORP_BIG );
	count.insertLast( CRITTER_BRAHMIN );
	count.insertLast( CRITTER_EVILPLANT_COUNT );
	count.insertLast( CRITTER_ALIEN_COUNT );
	count.insertLast( CRITTER_CLAW_SMAL_COUNT );
	count.insertLast( CRITTER_CLAW_COUNT );
	count.insertLast( CRITTER_CLAW_GRAY_COUNT );
	count.insertLast( CRITTER_GECKO_FIRE_COUNT );
	count.insertLast( CRITTER_CENTAUR_COUNT );
	count.insertLast( CRITTER_FLOATER_COUNT );
	count.insertLast( CRITTER_SWEMPER_COUNT );
	count.insertLast( CRITTER_RIPPER_M_COUNT );
	count.insertLast( CRITTER_RIPPER_F_COUNT );
	count.insertLast( CRITTER_RAIDER_M_COUNT );
	count.insertLast( CRITTER_RAIDER_F_COUNT );
	count.insertLast( CRITTER_RAIDER_A_COUNT );
	count.insertLast( CRITTER_RAIDER_B_COUNT );
	count.insertLast( CRITTER_RAIDER_C_COUNT );
	count.insertLast( CRITTER_SLAVER_COUNT );
	count.insertLast( CRITTER_RAIDER_D_COUNT );
	count.insertLast( CRITTER_RAIDER_E_COUNT );
	count.insertLast( CRITTER_RAIDER_F_COUNT );


    for( uint8 i = 0; i < CRITTER_MAP_COUNT; i++ )
    {

        @data0 = CritterInfo[ i * CRITTER_FIELD_COUNT + CRITTER_FIELD_PID ];
        // data = pids;

        @data1 = CritterInfo[ i * CRITTER_FIELD_COUNT + CRITTER_FIELD_PNT ];
        // data = spawns;

        @data2 = CritterInfo[ i * CRITTER_FIELD_COUNT + CRITTER_FIELD_POP ];
        // data = count;

        for( uint16 i = 0; i < CRITTER_COUNT; ++i )
        {
            data0.insertLast( CRITTER_PID_START + i );
            data1.insertLast( CRITTER_SPAWN_START + i );
            data2.insertLast( count[i] );
	    
	    //data2.insertLast(  );          /*CRITTER_PID_START+i*/
        }
        
	

    }
    // critter proto id section
    // data.insertLast();

    critters_inited = true;

    return true;

}
/*
   int	GetMapIndexByPid(uint16 pid){
        if(pid <= 0) return -1;

        int index;

        switch(pid){
                case MAP_SATTER_11	:	index = CRITTER_MAP_SAT_11; break;

        }
   }
 */
void AddCritter( Map& map )
{

    if( !critters_inited )
        CritterInfoInit();

    if( map.GetProtoId() < MAP_SATTER_11 || map.GetProtoId() > MAP_SATTER_CENTER_UP_1 )
        return;

    uint16 index = ( map.GetProtoId() - CRITTER_MAP_START );
    // Log("index "+index+" pr "+map.GetProtoId()+" s "+CRITTER_MAP_START);
    uint16[] @pids = CritterInfo[ index * CRITTER_FIELD_COUNT + CRITTER_FIELD_PID ];
    uint16[] @counts = CritterInfo[ index * CRITTER_FIELD_COUNT + CRITTER_FIELD_POP ];
    uint16[] @spawns = CritterInfo[ index * CRITTER_FIELD_COUNT + CRITTER_FIELD_PNT ];

    // Log("lens "+pids.length()+" "+counts.length()+" "+spawns.length());

    if( pids.length() != counts.length() || pids.length() != spawns.length() || spawns.length() != counts.length() )
    {
        Log( "len error" );
        return;
    }

    for( uint8 i = 0, j = pids.length(); /*CRITTER_COUNT;*/ i < j; ++i )
    {

        // @data = CritterInfo[]
        uint8  jj = map.CountEntire( spawns[ i ] );
        uint8  entNum = spawns[ i ];
        uint16 pid = pids[ i ];
        // Log(" ent "+entNum);
        uint8  teamId = Random( 24, 33 );

        for( uint8 ii = 0; ii < jj; ++ii )
        {
            uint16 hexX = 0, hexY = 0, tempX = 0, tempY = 0;

            map.GetEntireCoords( entNum, ii, hexX, hexY );

            tempX = hexX;
            tempY = hexY;

            uint8 count = counts[ i ];
	    
	    count = Random(0, count);

            for( uint8 iii = 0; iii < count; ++iii )
            {


                while( !map.IsHexPassed( tempX, tempY ) )
                {
                    tempX = hexX + Random( -10, 10 );
                    tempY = hexY + Random( -10, 10 );

                }
                ;

                Critter @ npc = map.AddNpc( pid, tempX, tempY, Random( 0, 5 ), null, null, "mob@_MobInit" );

                if( npc is null )
                    continue;

                npc.StatBase[ ST_AI_ID ] = CheckNpcAi( npc.CrType );
                npc.StatBase[ ST_TEAM_ID ] = teamId;

                // Log("aad");
            }
        }
    }
}
/*
   int16 GetCritInfo(uint16 mapProto, uint16 index, uin)
   {
   switch(mapProto)
   {
    case 20: switch(type)
              {
                case 0: return critterTypes_20[i];
                case 1: return critterPopul_20[i];
                case 2: return critterSpawn_20[i];
                case 3: return critterTypes_20.length();
                case 4: return 18;
              }
    case 101: switch(type)
              {
                case 0: return critterTypes_101[i];
                case 1: return critterPopul_101[i];
                case 2: return critterSpawn_101[i];
                case 3: return critterTypes_101.length();
                case 4: return 100;
              }
    case 103: switch(type)
              {
                case 0: return critterTypes_101[i];
                case 1: return critterPopul_101[i];
                case 2: return critterSpawn_101[i];
                case 3: return critterTypes_101.length();
                case 4: return 100;
              }
   }
   return 0;
   }
 */
// modoc ghost farm mobs

const uint16[] critterTypes_20 =
{
    80,                 // gold gecko
    83                  // silv gecko
};

const uint8[] critterPopul_20 =
{
    10,                 // gold gecko
    10                  // silv gecko
};

const uint8[] critterSpawn_20 =
{
    52,                 // gold gecko
    151                 // silv gecho
};


// satter east mobs

const uint16[] critterTypes_101 =
{
    5,                  // radscorpion
    9,                  // dog
    11,                 // rat
    85,                 // little deathclow
    113,                // bigrat
    117,                // verybig rat =)
    119,                // supermutant
    246,                // floater
    249                 // centaurus
};

const uint8[] critterPopul_101 =
{
    20,                 // radscorpion
    20,                 // dog
    40,                 // rat
    5,                  // little deathclow
    20,                 // bigrat
    7,                  // verybig rat =)
    5,                  // supermutant
    5,                  // floater
    5                   // centaurus
};

const uint8[] critterSpawn_101 =
{
    34,                 // radscorpion
    30,                 // dog
    31,                 // rat
    38,                 // little deathclow
    32,                 // bigrat
    33,                 // verybig rat =)
    37,                 // supermutant
    35,                 // floater
    36                  // centaurus
};

const uint16[] satterGroup =
{
    PID_FLARE,
    PID_ROCK,
    PID_PLANT_SPIKE,
    PID_STIMPAK,
    PID_ANTIDOTE,
    PID_NUKA_COLA,
    PID_BEER,
    PID_BOOZE,
    PID_GAMMA_GULP_BEER,
    PID_ROENTGEN_RUM,
    PID_ROT_GUT,
    PID_BOTTLE_CAPS,
    PID_REAL_BOTTLE_CAPS,
    PID_KNIFE,                                  // medium chance
    // PID_COMBAT_KNIFE,
    // PID_SPEAR,
    // PID_BRASS_KNUCKLES,
    PID_SCORPION_TAIL,
    PID_ROPE,
    PID_GECKO_PELT,
    PID_GOLDEN_GECKO_PELT,
    PID_FLINT,
    PID_MEAT_JERKY,
    PID_RADSCORPION_PARTS,
    PID_EMPTY_JET,
    PID_BOTTLE_GLASS,
    PID_BOTTLE_EMPTY,
    PID_PART_OF_ROPE,
    PID_METAL_TRASH,
    PID_GUNPOWDER,
    PID_METAL_ORE,
    PID_MINERAL,
    PID_TUBE,
    PID_STEEL,
    PID_BRAHMIN_SKIN,
    PID_MEAT,
    PID_CIGARETTES,
    PID_SHOVEL,
    PID_PLANK,
    PID_AXE,
    PID_LIGHTER,
    PID_WATER_FLASK,
    // PID_RADIO,
    // PID_LEATHER_JACKET,			//low chance
    PID_ZIP_GUN,
    // PID_9MM_MAUSER,
    // PID_10MM_PISTOL,
    // PID_14MM_PISTOL,
    // PID_DESERT_EAGLE,
    //  PID_44_MAGNUM_REVOLVER,
    // PID_HUNTING_RIFLE,
    //  PID_SHOTGUN,
    //  PID_10MM_SMG,
    PID_GOLD_NUGGET,
    PID_5MM_JHP,
    PID_5MM_AP,
    PID_7_62MM_AMMO,
    PID_9MM_AMMO,
    PID_9MM_BALL,
    PID_10MM_JHP,
    PID_10MM_AP,
    PID_14MM_AP,
    PID_44_MAGNUM_JHP,
    PID_44_FMJ_MAGNUM,
    PID_45_CALIBER_AMMO,
    PID_223_FMJ,
    PID_SHOTGUN_SHELLS,
    PID_MULTI_TOOL,
    // PID_FIRST_AID_KIT,
    PID_VIC_RADIO,
    PID_HYPODERMIC_NEEDLE,
    PID_FLAMETHROWER_FUEL
//        0				//dummy
};

const uint16[] satterGroupMod =
{
    5,                                  // flare
    10,                                 // rock
    10,                                 // plant spike
    2,                                  // stimpack
    3,                                  // antidote
    5,                                  // nukacola
    3,                                  // beer
    3,                                  // booz
    1,                                  // gamma
    1,                                  // roentgen
    1,                                  // rot gut
    20,                                 // caps
    40,                                 // realcaps
    1,                                  // knife
    // 1,				//cmb knife
    // 1,				//spear
    // 1,				//bracker knuckles
    1,                                  // scorpion tale
    3,                                  // rope
    2,                                  // gecko pelt
    1,                                  // golden gecko pelt
    1,                                  // flint
    1,                                  // jerky
    1,                                  // radscorpion parts
    3,                                  // empty jet
    5,                                  // glass
    10,                                 // bottle empty
    7,                                  // part of rope
    4,                                  // metal trash
    4,                                  // gunPowder
    2,                                  // metal ore
    1,                                  // mineral
    3,                                  // tube
    4,                                  // steel
    1,                                  // brahmin skin
    4,                                  // meat
    1,                                  // cigarettes
    1,                                  // shovel
    1,                                  // plant
    1,                                  // axe
    1,                                  // lighter
    1,                                  // water flask
    // 1,				//radio
    // 1,				//leather jacket
    1,                                  // zip gun
    // 1,				//mauser
    // 1,				//10mm
    // 1,				//14mm
    // 1,				//desert eagle
    // 1,				//magnum
    // 1,				//hunting rifle
    // 1,				//shotgun
    // 1,				//10mm smg
    1,                                  // gold nugget
    10,                                 // 5mm jhp
    10,                                 // 5mm ap
    10,                                 // 762
    10,                                 // 9mm
    10,                                 // 9mm ball
    20,                                 // 10mm jhp
    15,                                 // 10mm ap
    7,                                  // 14mm
    18,                                 // 44 jhp
    18,                                 // 44 fmj
    8,                                  // 45
    10,                                 // 223
    8,                                  // shotgun shell
    1,                                  // tool
    // 1,				//med tool
    1,                                  // PID_VIC_RADIO
    5,                                  // PID_HYPODERMIC_NEEDLE
    1                                   // PID_FLAMETHROWER_FUEL
//      0				//dummy
};

void additemsrndpic( Critter& cr, int id, int x, int y )
{
    Map @ map = cr.GetMap();
    if( map is null )
    {
        cr.Say( SAY_NETMSG, "map" );
        return;
    }

    for( uint8 i = 0; i < x; ++i )
    {
        Item @ item = map.AddItem( cr.HexX + ( Random( -10, 10 ) ), cr.HexY + ( Random( -10, 10 ) ), 2004, 1 );
        if( item is null )
            continue;
        /*
           string = "";
           brl1000.frm
         * brl2000.frm
         * tirs002.frm
         * weed05.frm
         * weed08.frm
         * boxes1.frm
         * boxes2.frm
         * boxes3.frm
         * boxes4.frm
         * car2.frm
         * car4.frm
         * chair1.frm
         * chair3.frm
         * njunk5.frm
         * njunk6.frm
         * trash3.frm
         * trash1.frm
         */

        uint hash = GetStrHash( "art\\scenery\\corpse1.png" );


        item.SetMapPic( hash );

        cr.Say( SAY_NETMSG, "add " + hash );
    }

}



void setpic( Critter& cr, int id, int x, int y )
{
    Item @ item = GetItem( id );
    if( item is null )
        return;
    string temp = "art\\scenery\\";
    temp += "boxes3.frm";
    item.SetMapPic( GetLOHash( GROUP_TRASH ) );
    item.Update();
}

void itemrndpic( Critter& cr, int id, int x, int y )
{
    // Item @ item = GetItem(id);
    // if(item is null) return;

    // uint hash = GetStrHash("art\\scenery\\corpse1.png");
    // item.SetMapPic(hash);

    CLO @ clo = CLO( GROUP_TRASH, 100, false );
    Map @ map = cr.GetMap();
    if( clo is null )
    {
        cr.Say( SAY_NETMSG, "clo null" );
    }
    if( map is null )
    {
        cr.Say( SAY_NETMSG, "map null" );
    }

    string msg_ = "fail.";

    if( clo.Add( map ) )
    {
        msg_ = ( "succesfull " + clo.HexX + ":" + clo.HexY + "\n clo : " + clo.Hash );

        if( !cr.TransitToHex( clo.HexX, clo.HexY, 1 ) )
        {
            cr.ShowContainer( cr, clo.Object, 0 );
        }
    }

    cr.Say( SAY_NETMSG, msg_ );
}
void forcespawn( Critter& cr, int id, int x, int y )
{
    Map @ map = ( id <= 0 ? cr.GetMap() : GetMap( id ) );
    if( map is null )
    {
        cr.Say( SAY_NETMSG, "null map" );
        return;
    }
    if( x > 0 )
    {
        FillContainer( map );
    }
    SpawnLO( map );
}




bool SpawnLO( Map& map )
{
    int rechLvl = MAX_RECH_LEVEL;
    for( uint16 i = 0; i < MAX_LO_COUNT; ++i )
    {
        uint8 temp = Random( 1, 99 );
        rechLvl -= temp;
        if( rechLvl > 0 )
        {
            CLO @ clo = CLO( Random( 0, GROUP_LENGTH - 1 ), temp, false );

            if( clo is null )
            {
                Log( "clo null" );
            }

            clo.Add( map );

            // Log("clo add "+clo.HexX+":"+clo.HexY);
        }

    }
    return true;
}

bool SpawnItemCell( uint mapId )
{
    Map @ map = GetMap( mapId );
    if( !(map is null) )
    {
        FillContainer( map );
        SpawnLO( map );
        return true;
    }

    return false;
}
